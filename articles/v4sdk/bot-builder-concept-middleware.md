---
title: 미들웨어 | Microsoft Docs
description: 미들웨어를 이해하고 봇 SDK에서 어떤 용도로 사용되는지 알아봅니다.
keywords: 미들웨어, 미들웨어 파이프라인, 단락, 미들웨어 사용
author: ivorb
ms.author: v-ivorb
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 05/24/2018
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 9986ac7d46acfa94694456d653b91dd66c1f55f0
ms.sourcegitcommit: f95702d27abbd242c902eeb218d55a72df56ce56
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/19/2018
ms.locfileid: "39304651"
---
# <a name="middleware"></a>미들웨어

[!INCLUDE [pre-release-label](~/includes/pre-release-label.md)]

미들웨어는 간단하게 말해서 어댑터와 봇 논리 사이에 위치하는 클래스로, 초기화하는 동안 어댑터의 미들웨어 컬렉션에 추가됩니다. SDK를 사용하면 사용자 고유의 미들웨어를 작성하거나 다른 사람이 만든 재사용 가능한 미들웨어 구성 요소를 추가할 수 있습니다. 미들웨어에서 무엇을 할 수 있나요? 무엇이든 가능합니다... 봇으로 들어오거나 봇에서 나가는 모든 작업은 미들웨어를 통과합니다.

어댑터는 봇 미들웨어 파이프라인을 통해 들어오는 작업을 처리하고 봇의 논리로 안내한 후 다시 밖으로 내보냅니다. 각 작업이 봇으로 들어가고 나올 때 미들웨어의 각 부분은 봇 논리가 실행되기 전과 후에 작업을 검사하거나 작업에 따라 작동합니다.

미들웨어를 살펴보기 전에, 먼저 [봇의 일반론](~/v4sdk/bot-builder-basics.md) 및 [봇이 작업을 처리하는 방식](~/v4sdk/bot-builder-concept-activity-processing.md)을 이해해야 합니다.

## <a name="uses-for-middleware"></a>미들웨어 사용

자주 묻는 질문: 미들웨어와 봇 논리 중에서 무엇을 사용해야 하나요? 미들웨어는 상당히 유연하므로 결국에는 사용자에게 달렸습니다. 미들웨어의 좋은 사용 사례 몇 가지를 살펴보겠습니다.

### <a name="looking-at-or-acting-on-every-activity"></a>모든 작업을 살펴보거나 모든 작업에 따라 작동

bot이 모든 작업 또는 특정 유형의 모든 작업에 대해 무언가를 해야 하는 여러 상황이 있습니다. 예를 들어 봇이 수신하는 모든 메시지 작업을 기록하거나, 봇이 이 순서에 대한 응답을 생성하지 않으면 대체 응답을 제공하려는 경우가 있습니다. 미들웨어는 나머지 봇 논리가 실행되기 전과 후에 작동하는 기능을 갖고 있기 때문에 이 시나리오를 구현하기에 매우 좋습니다.

### <a name="modifying-or-enhancing-the-turn-context"></a>턴 컨텍스트 수정 또는 개선

작업에 제공되는 정보보다 더 많은 정보를 봇이 갖고 있으면 특정 대화가 훨씬 유익할 수 있습니다. 이 경우 미들웨어는 지금까지의 대화 상태 정보를 살펴보고, 외부 데이터 원본을 쿼리하고, 컨텍스트 개체에 추가한 후 봇 논리에 대한 실행을 전달할 수 있습니다.
예를 들어 미들웨어는 대화 ID 및 상태 같은 대화 세부 정보를 식별한 다음, 디렉터리 서비스에 정보를 쿼리할 수 있습니다. 미들웨어는 외부 쿼리에서 받은 사용자 개체를 컨텍스트 개체에 추가 및 전달하고, 봇이 요청을 잘 처리할 수 있도록 사용자에 대한 더 많은 데이터를 제공합니다.

미들웨어는 위의 사용자 또는 또 다른 사용자로 완전히 나눌 수 있습니다. 이는 사용자가 원하는 봇의 구조 및 봇의 목적에 따라 결정됩니다.
미들웨어는 상태를 설정 또는 유지하고, 들어오는 요청에 대응하고, 파이프라인을 단락시킬 수 있습니다.
미들웨어 후보는 다음과 같습니다.

- **저장소 또는 지속성**: 한 턴 후에 미들웨어를 사용하여 값을 저장 또는 유지하거나, 해당 턴에서 발생한 일에 따라 일부 값을 업데이트합니다.
- **정상적으로 오류 처리 또는 실패**: 예외가 throw 되면 미들웨어는 해당 예외에 대한 친숙한 메시지를 보낼 수 있습니다.
- **번역**: 이 미들웨어는 들어오는 메시지를 검색 및 번역하고, 나가는 메시지를 검색된 들어오는 언어로 다시 번역하도록 설정할 수 있습니다.

사용자가 고유의 미들웨어를 정의할 수 있고, 아니면 SDK가 다음과 같은 응용 프로그램 독립적 구성 요소를 나타내는 미들웨어를 정의합니다.

- 컨텍스트 개체의 상태 정보를 유지 및 복원하는 상태 미들웨어. 이 SDK는 대화 및 사용자 상태 미들웨어를 제공합니다.
- 입력된 언어를 인식하고 응용 프로그램에서 인식할 수 있는 다른 언어로 번역할 수 있는 번역 미들웨어.
- 수신 및 송신 작업을 기록할 수 있는 로깅 미들웨어.

## <a name="the-bot-middleware-pipeline"></a>봇 미들웨어 파이프라인

각 작업에 대해 어댑터는 미들웨어를 **추가된 순서대로** 호출합니다. 어댑터는 턴 및 _다음_ 대리자에 대한 컨텍스트 개체를 전달하고, 미들웨어는 파이프라인의 다음 미들웨어에 컨트롤을 전달할 대리자를 호출합니다. 또한 미들웨어는 _다음_ 대리자가 메서드를 반환한 후부터 완료하기 전까지 작업을 수행할 수 있는 기회가 있습니다. 각 미들웨어 개체에는 파이프라인에서 따르는 미들웨어 개체와 관련하여 작동할 수 있는 처음이자 마지막 기회가 있는 것으로 생각하셔도 좋습니다.

예: 

- 첫 번째 미들웨어 개체의 턴 처리기가 _다음_을 호출하기 전에 코드를 실행합니다.
  - 두 번째 미들웨어 개체의 턴 처리기가 _다음_을 호출하기 전에 코드를 실행합니다.
    - 봇의 턴 처리기가 실행 및 반환됩니다.
  - 두 번째 미들웨어 개체의 턴 처리기가 나머지 코드를 실행한 후 반환됩니다.
- 첫 번째 미들웨어 개체의 턴 처리기가 나머지 코드를 실행한 후 반환됩니다.

미들웨어가 다음 대리자를 호출하지 않으면 어댑터가 후속 미들웨어 또는 봇 턴 처리기를 호출하지 않고 파이프라인이 단락됩니다.

봇 미들웨어 파이프라인이 완료되면 턴이 끝나고, 턴 컨텍스트가 범위를 벗어납니다.

미들웨어 또는 봇은 응답을 생성하고 응답 이벤트 처리기를 등록할 수 있지만, 응답이 별도의 프로세스에서 처리된다는 사실을 기억해야 합니다.

## <a name="order-of-middleware"></a>미들웨어 순서

미들웨어가 추가되는 순서에 따라 미들웨어가 작업을 처리하는 순서가 결정되므로 미들웨어 추가 순서를 결정하는 것이 중요합니다.

> [!NOTE]
> 이것은 대부분의 봇에서 작동하는 일반적인 패턴을 제공하기 위한 의도이지만, 미들웨어의 각 부분이 상황에 맞게 상호 작용하는 방식을 고려해야 합니다.

미들웨어 파이프라인의 첫 번째 작업은 매번 사용되는 최하위 수준 작업을 처리하는 것일 확률이 높습니다. 로깅, 예외 처리, 상태 관리 및 번역을 예로 들 수 있습니다. 순서는 들어오는 메시지를 먼저 번역할 것인지, 예외를 처리하기 전에 할 것인지, 예외를 먼저 처리할 것인지 등의 요구 사항에 따라 달라질 수 있으며, 예외를 먼저 처리한다는 것은 예외 메시지를 번역하지 않는다는 의미일 수 있습니다.

미들웨어 파이프라인의 마지막은 봇 관련 미들웨어로, 봇으로 전송된 모든 메시지에 대한 처리 작업을 수행하도록 구현하는 미들웨어입니다. 미들웨어가 상태 정보 또는 봇 컨텍스트에 설정된 기타 정보를 사용하는 경우 상태 또는 컨텍스트를 수정하는 미들웨어 뒤에 있는 미들웨어 파이프라인에 해당 미들웨어를 추가합니다.

## <a name="short-circuiting"></a>단락

미들웨어(및 [이벤트 처리기](~/v4sdk/bot-builder-concept-activity-processing.md#response-event-handlers))와 관련된 중요한 개념 중 하나는 _단락_입니다. 이어지는 레이어를 통해 예외가 계속되는 경우 미들웨어(또는 처리기)는 _다음_ 대리자를 호출하여 실행을 전달해야 합니다.  해당 미들웨어(또는 처리기) 내에서 다음 대리자를 호출하지 않으면 현재 파이프라인이 단락되고 후속 레이어가 실행되지 않습니다. 즉, 모든 봇 논리와 파이프라인에서 뒤에 있는 미들웨어를 건너뜁니다.

이벤트 처리기의 경우 _다음_을 호출하지 않으면 이벤트가 취소되고, 미들웨어 건너뛰기 논리와 크게 다른 결과로 이어집니다. 어댑터는 이벤트의 나머지 부분을 처리하지 않음으로써 절대로 이벤트를 보내지 않습니다.

> [!TIP]
> `SendActivities`처럼 이벤트를 단락시키는 경우 본인이 의도한 동작이어야 합니다. 그렇지 않으면 매우 혼란스러운 버그가 발생할 수 있습니다.

## <a name="next-steps"></a>다음 단계

봇의 몇 가지 주요 개념에 익숙해졌으니, 봇이 사전 대응 메시지를 보내는 방법을 자세히 살펴보겠습니다.

> [!div class="nextstepaction"]
> [사전 대응 메시지](~/v4sdk/bot-builder-proactive-messages.md)
